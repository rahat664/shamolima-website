<ng-container *ngIf="home$ | async as home">
  <section class="page-hero page-hero--navy home-hero" @fadeIn>
    <!-- Carousel Background Images -->
    <div class="home-hero__carousel">
      <div class="home-hero__slide" *ngIf="heroSlideIndex === 0" [class.active]="true">
        <picture>
          <source srcset="assets/images/webp/fleet_yard.webp" type="image/webp">
          <img class="home-hero__image" data-no-gallery="true"
               ngSrc="assets/images/fleet_yard.jpg"
               fill
               [priority]="heroSlideIndex === 0"
               alt="">
        </picture>
      </div>
      <div class="home-hero__slide" *ngIf="heroSlideIndex === 1" [class.active]="true">
        <picture>
          <source srcset="assets/images/webp/generator_transformer.webp" type="image/webp">
          <img class="home-hero__image" data-no-gallery="true"
               ngSrc="assets/images/generator_transformer.jpg"
               fill
               [priority]="heroSlideIndex === 1"
               alt="">
        </picture>
      </div>
      <div class="home-hero__slide" *ngIf="heroSlideIndex === 2" [class.active]="true">
        <picture>
          <source srcset="assets/images/webp/project_equipment.webp" type="image/webp">
          <img class="home-hero__image" data-no-gallery="true"
               ngSrc="assets/images/project_equipment.jpg"
               fill
               [priority]="heroSlideIndex === 2"
               alt="">
        </picture>
      </div>
    </div>

    <div class="page-hero__layer page-hero__layer--gradient"></div>
    <div class="page-hero__orb page-hero__orb--one"></div>
    <div class="page-hero__orb page-hero__orb--two"></div>

    <div class="container grid gap-12 lg:grid-cols-[minmax(0,1.15fr)_minmax(0,1fr)] lg:items-center" *ngIf="ui$ | async as ui">
      <div>
        <p class="kicker text-brand">{{ ui.pages.home.kicker }}</p>
        <h1 class="page-hero__title">{{ home.hero.headline }}</h1>
        <p class="page-hero__lede" appRevealOnScroll="fade" [delay]="800">{{ home.hero.subhead }}</p>

        <div class="page-hero__tags" role="list" appRevealOnScroll="up" [delay]="1000">
          <span class="tag-chip" *ngFor="let tag of home.heroTags; trackBy: trackByTag" role="listitem">{{ tag }}</span>
        </div>

        <div class="page-hero__actions" appRevealOnScroll="up" [delay]="1200">
          <a routerLink="/quote" class="btn btn-primary btn--glow">{{ ui.pages.home.heroButtons.startBrief }}</a>
          <a routerLink="/services" class="btn btn--light">{{ ui.pages.home.heroButtons.exploreServices }}</a>
        </div>
      </div>

      <div class="grid gap-4 sm:grid-cols-2">
        <article *ngFor="let stat of home.stats; let i = index" class="stat-card" appRevealOnScroll="zoom" [delay]="i * 150">
          <div class="stat-card__value" [appAnimateCounter]="stat.value" [counterDuration]="2000" [counterDelay]="400 + (i * 150)"></div>
          <p class="stat-card__label">{{ stat.label }}</p>
          <p *ngIf="stat.detail" class="stat-card__detail">{{ stat.detail }}</p>
        </article>
      </div>
    </div>

    <!-- Carousel Indicators -->
    <div class="hero-carousel-dots">
      <button *ngFor="let i of [0,1,2]"
              class="hero-carousel-dot"
              [class.active]="heroSlideIndex === i"
              (click)="setHeroSlide(i)"
              [attr.aria-label]="'Go to slide ' + (i + 1)">
      </button>
    </div>
  </section>
</ng-container>

<!-- Video Section -->
<section class="section section--video" @fadeIn>
  <div class="container" *ngIf="ui$ | async as ui">
    <div class="text-center mb-8">
      <p class="kicker kicker--light" appRevealOnScroll="fade">{{ ui.pages.home.sections.video.kicker }}</p>
      <h2 class="section-title section-title--light" appRevealOnScroll="up" [delay]="100">
        {{ ui.pages.home.sections.video.title }}
      </h2>
      <p class="section-lede section-lede--light max-w-3xl mx-auto" appRevealOnScroll="fade" [delay]="200">
        {{ ui.pages.home.sections.video.description }}
      </p>
    </div>
    <div class="video-container" appRevealOnScroll="zoom" [delay]="300">
      <video
        class="promo-video"
        controls
        preload="metadata"
        poster="assets/images/fleet_yard.jpg">
        <source src="assets/videos/shamolima_promo.mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    </div>
  </div>
</section>

<section class="section section--bright" @fadeIn>
  <div class="container grid gap-10 lg:grid-cols-[minmax(0,1.4fr)_minmax(0,1fr)]">
    <div *ngIf="ui$ | async as ui">
      <p class="kicker text-brand" appRevealOnScroll="fade">{{ ui.pages.home.sections.integratedLogistics.kicker }}</p>
      <h2 class="section-title" appRevealOnScroll="up" [delay]="100">{{ ui.pages.home.sections.integratedLogistics.title }}</h2>
      <p class="section-lede" appRevealOnScroll="fade" [delay]="200">{{ aboutSnippet$ | async }}</p>

      <div class="mt-10 grid gap-6 sm:grid-cols-2">
        <article *ngFor="let pillar of (home$ | async)?.focusAreas; trackBy: trackByFocus; let i = index" class="feature-card" appRevealOnScroll="up" [delay]="i * 100">
          <span class="feature-card__badge">{{ pillar.badge }}</span>
          <h3 class="feature-card__title">{{ pillar.title }}</h3>
          <p class="feature-card__copy">{{ pillar.copy }}</p>
        </article>
      </div>
    </div>

    <aside class="insight-card" appRevealOnScroll="left" [delay]="200" *ngIf="ui$ | async as ui">
      <h3 class="insight-card__heading">{{ ui.pages.home.sections.whyChoose }}</h3>
      <ul class="insight-card__list">
        <li *ngFor="let item of (home$ | async)?.highlights; trackBy: trackByHighlight">
          <span class="insight-card__title">{{ item.title }}</span>
          <span class="insight-card__detail">{{ item.detail }}</span>
        </li>
      </ul>

      <div class="insight-card__cta" *ngIf="(certificates$ | async) as certificates">
        <p class="font-semibold">{{ ui.pages.home.certifications }}</p>
        <div class="home-certificates" data-gallery>
          <img *ngFor="let cert of certificates; let i = index; trackBy: trackByUrl"
               class="cert-image"
               [src]="cert"
               [alt]="getCertificateAlt(i)"
               [title]="getCertificateAlt(i)"
               loading="lazy">
        </div>
      </div>

      <div class="insight-card__cta" *ngIf="contactEmail$ | async as email">
        <p class="font-semibold">{{ ui.pages.home.needExpertise }}</p>
        <p>{{ ui.pages.home.emailPrefix }} <a class="text-brand hover:underline" [href]="'mailto:' + email">{{ email }}</a></p>
      </div>
    </aside>
  </div>
</section>

<ng-container *ngIf="(spotlight$ | async) as spotlight">
  <section *ngIf="spotlight.length" class="section section--navy" @fadeIn>
    <div class="container" *ngIf="ui$ | async as ui">
      <div class="flex flex-wrap items-end justify-between gap-6">
        <div>
          <p class="kicker text-brand" appRevealOnScroll="fade">{{ ui.pages.home.sections.spotlight.kicker }}</p>
          <h2 class="section-title text-white" appRevealOnScroll="up" [delay]="100">{{ ui.pages.home.sections.spotlight.title }}</h2>
        </div>
        <p class="max-w-xl text-sm text-white/70" appRevealOnScroll="fade" [delay]="200">
          {{ ui.pages.home.sections.spotlight.description }}
        </p>
      </div>

      <div class="spotlight-carousel mt-10" *ngIf="spotlight as slides" (mouseenter)="pauseAutoplay()" (mouseleave)="resumeAutoplay()">
        <button class="carousel__nav carousel__nav--prev" type="button" aria-label="{{ ui.common.previous }}" (click)="prevSpotlight(slides.length)">&#10094;</button>
        <div class="carousel__viewport">
          <article *ngFor="let item of slides; let i = index; trackBy: trackByImage"
                   class="spotlight-card"
                   [class.is-active]="i === spotlightIndex"
                   [hidden]="i !== spotlightIndex">
            <img [src]="item.image" [alt]="item.caption" loading="lazy" class="spotlight-card__image">
            <div class="spotlight-card__scrim"></div>
            <div class="spotlight-card__content">
              <span class="spotlight-card__badge">{{ ui.pages.home.sections.spotlight.badge }}</span>
              <h3 class="spotlight-card__title">{{ item.caption }}</h3>
            </div>
          </article>
        </div>
        <button class="carousel__nav carousel__nav--next" type="button" aria-label="{{ ui.common.next }}" (click)="nextSpotlight(slides.length)">&#10095;</button>
      </div>
    </div>
  </section>
</ng-container>

<section class="section" @fadeIn>
  <div class="container" *ngIf="ui$ | async as ui">
    <p class="kicker text-brand" appRevealOnScroll="fade">{{ ui.pages.home.sections.clients.kicker }}</p>
    <h2 class="section-title" appRevealOnScroll="up" [delay]="100">{{ ui.pages.home.sections.clients.title }}</h2>
    <div class="clients-carousel-wrapper mt-8" *ngIf="clients$ | async as clients" appRevealOnScroll="fade" [delay]="200">
      <div class="clients-carousel">
        <div class="clients-track">
          <!-- First set of logos -->
          <ng-container *ngFor="let c of clients; trackBy: trackByClient">
            <div class="client-card">
              <img class="client-logo"
                   [src]="c.logo || 'assets/logo/shamolima.png'"
                   [alt]="c.name"
                   [title]="c.name"
                   loading="lazy"
                   onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-flex';">
              <span class="client-chip" style="display: none;">{{ c.name }}</span>
            </div>
          </ng-container>
          <!-- Duplicate set for seamless loop -->
          <ng-container *ngFor="let c of clients; trackBy: trackByClient">
            <div class="client-card">
              <img class="client-logo"
                   [src]="c.logo || 'assets/logo/shamolima.png'"
                   [alt]="c.name"
                   [title]="c.name"
                   loading="lazy"
                   onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-flex';">
              <span class="client-chip" style="display: none;">{{ c.name }}</span>
            </div>
          </ng-container>
        </div>
      </div>
      <p class="text-center text-sm text-slate-500 mt-6">{{ ui.pages.home.sections.clients.tagline }}</p>
    </div>
  </div>
</section>

<!-- Certificates Carousel Section -->
<section class="section section--certificates" @fadeIn>
  <div class="container" *ngIf="ui$ | async as ui">
    <h2 class="section-title" appRevealOnScroll="up" [delay]="100">{{ ui.pages.home.certifications }}</h2>
    <div class="certificates-carousel mt-6"
         *ngIf="(certificates$ | async) as certificates"
         (mouseenter)="pauseCertAutoplay()"
         (mouseleave)="resumeCertAutoplay()"
         (touchstart)="onCertTouchStart($event)"
         (touchend)="onCertTouchEnd($event)"
         (keydown)="onCertKey($event)"
         tabindex="0"
         role="region"
         aria-roledescription="carousel"
         aria-label="Certificates carousel">
      <button class="carousel__nav carousel__nav--prev"
              type="button"
              [attr.aria-label]="ui.common.previous"
              (click)="prevCert(certificates.length)">
        &#10094;
      </button>
      <div class="carousel__viewport certificates-viewport" data-gallery>
        <article *ngFor="let cert of certificates; let i = index; trackBy: trackByUrl"
                 class="cert-card"
                 [class.is-active]="i === certIndex"
                 [class.is-prev]="i === ((certIndex - 1 + certificates.length) % certificates.length)"
                 [class.is-next]="i === ((certIndex + 1) % certificates.length)"
                 [hidden]="!(i === certIndex || i === ((certIndex - 1 + certificates.length) % certificates.length) || i === ((certIndex + 1) % certificates.length))">
          <img [src]="cert"
               [alt]="getCertificateAlt(i)"
               [title]="getCertificateAlt(i)"
               loading="lazy"
               class="cert-card__image">
        </article>
      </div>
      <button class="carousel__nav carousel__nav--next"
              type="button"
              [attr.aria-label]="ui.common.next"
              (click)="nextCert(certificates.length)">
        &#10095;
      </button>

      <!-- Dots -->
      <div class="cert-dots" role="tablist" aria-label="Certificates navigation">
        <button *ngFor="let _ of certificates; index as i"
                class="cert-dot"
                role="tab"
                [attr.aria-selected]="i === certIndex"
                [class.active]="i === certIndex"
                (click)="setCert(i, certificates.length)"
                [attr.aria-label]="'Go to certificate ' + (i + 1)"></button>
      </div>
    </div>
  </div>
  
</section>

<section class="section" @fadeIn>
  <div class="container" *ngIf="ui$ | async as ui">
    <p class="kicker text-brand" appRevealOnScroll="fade">{{ ui.pages.home.sections.howWeDeliver.kicker }}</p>
    <h2 class="section-title" appRevealOnScroll="up" [delay]="100">{{ ui.pages.home.sections.howWeDeliver.title }}</h2>

    <div class="mt-10 grid gap-8 md:grid-cols-2">
      <article *ngFor="let phase of (home$ | async)?.phases; trackBy: trackByPhase; index as idx" class="phase-card" appRevealOnScroll="flip" [delay]="idx * 150">
        <div class="phase-card__index">{{ idx + 1 }}</div>
        <h3 class="phase-card__title">{{ phase.title }}</h3>
        <p class="phase-card__copy">{{ phase.copy }}</p>
        <ul class="phase-card__list">
          <li *ngFor="let point of phase.points">{{ point }}</li>
        </ul>
      </article>
    </div>
  </div>
</section>

<section class="section section--bright" @fadeIn>
  <div class="container" *ngIf="ui$ | async as ui">
    <p class="kicker text-brand" appRevealOnScroll="fade">{{ ui.pages.home.sections.recentProjects.kicker }}</p>
    <h2 class="section-title" appRevealOnScroll="up" [delay]="100">{{ ui.pages.home.sections.recentProjects.title }}</h2>
    <div class="mt-8 grid gap-6 md:grid-cols-2">
      <article *ngFor="let p of (recentProjects$ | async)!; trackBy: trackByProject; let i = index" class="feature-card" appRevealOnScroll="up" [delay]="i * 100">
        <span class="feature-card__badge">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
        </span>
        <h3 class="feature-card__title">{{ p.title }}</h3>
        <p class="feature-card__copy">{{ p.description }}</p>
        <p class="text-sm text-slate-500 mt-2"><strong>{{ ui.common.location }}:</strong> {{ p.location }}</p>
        <div class="mt-2 flex flex-wrap gap-2">
          <span class="chip" *ngFor="let eq of p.keyEquipment">{{ eq }}</span>
        </div>
      </article>
    </div>
  </div>
</section>

<section class="section section--gallery" id="gallery" [@listStagger]>
  <div class="container" *ngIf="ui$ | async as ui">
    <div class="flex flex-wrap items-end justify-between gap-6">
      <div>
        <p class="kicker text-brand" appRevealOnScroll="fade">{{ ui.pages.home.sections.gallery.kicker }}</p>
        <h2 class="section-title" appRevealOnScroll="up" [delay]="100">{{ ui.pages.home.sections.gallery.title }}</h2>
        <p class="section-lede" appRevealOnScroll="fade" [delay]="200">{{ ui.pages.home.sections.gallery.description }}</p>
      </div>
    </div>

    <div *ngIf="(galleryItems$ | async) as items" class="masonry mt-10 columns-1 sm:columns-2 lg:columns-3" data-gallery>
      <figure *ngFor="let item of items; trackBy: trackByImage; let i = index" class="gallery-card" appRevealOnScroll="zoom" [delay]="i * 50" [threshold]="0.05">
        <img [src]="thumbFor(item.image)" [attr.data-fullsrc]="item.image" [alt]="item.caption" loading="lazy" decoding="async" class="gallery-card__image">
        <figcaption class="gallery-card__caption">{{ item.caption }}</figcaption>
      </figure>
    </div>

    <p class="mt-6 text-xs text-slate-500" appRevealOnScroll="fade">{{ ui.pages.home.sections.gallery.note }}</p>
  </div>
</section>

<app-footer />
